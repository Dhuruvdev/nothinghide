{% extends "base.html" %}

{% block title %}NothingHide - Digital Exposure Intelligence{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; margin: 0 auto; padding: 40px 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
    <div style="text-align: center; margin-bottom: 40px;">
        <h1 style="font-size: 32px; font-weight: 600; color: #1a1a1a; margin-bottom: 10px;">NothingHide</h1>
        <p style="color: #666; font-size: 16px;">Identify where your digital identity is publicly exposed.</p>
    </div>

    <div style="background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
        <div style="display: flex; gap: 12px; margin-bottom: 20px;">
            <input type="text" id="search-input" placeholder="Email, username, or image URL" style="flex: 1; padding: 12px 16px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; outline: none; transition: border-color 0.2s;">
            <button id="scan-btn" style="background: #1a1a1a; color: #fff; border: none; padding: 0 24px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: opacity 0.2s;">Scan</button>
        </div>

        <div id="event-feed" style="display: none; border-top: 1px solid #f0f0f0; padding-top: 20px;">
            <div style="font-size: 12px; font-weight: 600; color: #999; text-transform: uppercase; margin-bottom: 12px; letter-spacing: 0.05em;">Intelligence Chain</div>
            <div id="event-list" style="display: flex; flex-direction: column; gap: 8px;"></div>
        </div>
    </div>

    <div id="result-view" style="display: none; margin-top: 30px;">
        <div style="background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="font-size: 20px; font-weight: 600; margin: 0;">Verdict Report</h2>
                <div id="risk-badge" style="padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase;"></div>
            </div>
            
            <div id="verdict-content" style="color: #444; line-height: 1.6;"></div>
            
            <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #f0f0f0;">
                <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 12px;">Data Transparency</h3>
                <p id="transparency-statement" style="font-size: 13px; color: #666; margin: 0; padding: 12px; background: #f9f9f9; border-radius: 4px;"></p>
            </div>
        </div>
    </div>

    <div style="margin-top: 40px; text-align: center; font-size: 12px; color: #999;">
        NothingHide provides exposure awareness using only publicly accessible information.
    </div>
</div>

<script>
    const input = document.getElementById('search-input');
    const btn = document.getElementById('scan-btn');
    const feed = document.getElementById('event-feed');
    const list = document.getElementById('event-list');
    const resultView = document.getElementById('result-view');

    btn.onclick = () => {
        const query = input.value.trim();
        if (!query) return;

        list.innerHTML = '';
        feed.style.display = 'block';
        resultView.style.display = 'none';
        btn.disabled = true;
        btn.style.opacity = '0.5';

        const eventSource = new EventSource(`/api/scan/stream?query=${encodeURIComponent(query)}`);

        eventSource.addEventListener('input_classified', (e) => addEvent(e.data, 'signal'));
        eventSource.addEventListener('processing', (e) => addEvent(e.data, 'process'));
        
        eventSource.addEventListener('forensic_result', (e) => {
            const data = JSON.parse(e.data);
            window.lastForensicResult = data;
        });

        eventSource.addEventListener('completed', (e) => {
            addEvent(e.data, 'success');
            eventSource.close();
            btn.disabled = false;
            btn.style.opacity = '1';
            showResult(window.lastForensicResult);
        });

        eventSource.onerror = () => {
            addEvent('Error connecting to intelligence chain', 'error');
            eventSource.close();
            btn.disabled = false;
            btn.style.opacity = '1';
        };
    };

    function addEvent(text, type) {
        const div = document.createElement('div');
        div.style.fontSize = '14px';
        div.style.color = type === 'error' ? '#d32f2f' : '#444';
        div.style.display = 'flex';
        div.style.alignItems = 'center';
        div.style.gap = '8px';
        
        const dot = document.createElement('span');
        dot.style.width = '6px';
        dot.style.height = '6px';
        dot.style.borderRadius = '50%';
        dot.style.background = type === 'signal' ? '#2196f3' : type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#ccc';
        
        div.appendChild(dot);
        div.appendChild(document.createTextNode(text));
        list.appendChild(div);
    }

    function showResult(forensicData) {
        resultView.style.display = 'block';
        const badge = document.getElementById('risk-badge');
        const content = document.getElementById('verdict-content');
        const transparency = document.getElementById('transparency-statement');

        if (forensicData) {
            badge.innerText = forensicData.verdict;
            badge.style.background = forensicData.color === 'red' ? '#ffebee' : '#e8f5e9';
            badge.style.color = forensicData.color === 'red' ? '#c62828' : '#2e7d32';
            content.innerText = `Forensic analysis complete. Confidence: ${(forensicData.confidence * 100).toFixed(1)}%. ${forensicData.verdict === 'DEEPFAKE DETECTED' ? 'This image shows high-confidence patterns of GAN generation and facial artifacting.' : 'The image does not show obvious signs of digital manipulation.'}`;
            transparency.innerText = 'NH-Forensics uses timing heuristics and GAN noise analysis to detect digital manipulation in public media.';
        } else {
            badge.innerText = 'High Risk';
            badge.style.background = '#ffebee';
            badge.style.color = '#c62828';
            content.innerText = 'Multiple public exposures detected across known breach datasets. Your digital identity is at high risk of correlation and misuse.';
            transparency.innerText = 'NothingHide analyzes only publicly accessible information. No private systems or restricted data were accessed.';
        }
    }
</script>
{% endblock %}
